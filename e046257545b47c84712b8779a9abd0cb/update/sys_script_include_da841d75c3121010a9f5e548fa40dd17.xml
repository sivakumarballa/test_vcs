<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>sn_app_eng_studio.AesAppRejectionEmail</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Script to generate email body for AES app rejection</description>
        <name>AesAppRejectionEmail</name>
        <script><![CDATA[var AesAppRejectionEmail = Class.create();
AesAppRejectionEmail.prototype = {
    initialize: function(deploymentRequest) {
        this.deploymentRequest = deploymentRequest;
    },
    getBody: function() {
        var aesEmailScript = new AesEmailScript();
        var style = aesEmailScript.getStyles();
        var trailingSlashRegex = aesEmailScript.getTrailingSlashRegex();
        var path = '/now/appenginestudio/my-apps/';
        var deploymentRequest = this.deploymentRequest;
        var userName = deploymentRequest.requestor_user_name;

        var footerMessage = gs.getMessage('You have received this email to update you about your recent App Engine Studio creation.');
        var headerMessage = gs.getMessage('{0} app was not approved.', deploymentRequest.app_name);

        var adminEmailPropertyValue = gs.getProperty('sn_app_eng_studio.aes_admin_contact');
        var htmlLinkStart = "";
        var htmlLinkEnd = "";

        if (adminEmailPropertyValue) {
            htmlLinkStart = '<a style="' + style.link + '" href="mailto:' + adminEmailPropertyValue + '">';
            htmlLinkEnd = '</a>';
        }

        var adminContactMessage = gs.getMessage('{0}Contact your administrator{1} to resolve any issues with your app.', [htmlLinkStart, htmlLinkEnd]);


        var appUrl;
		
		try {
			var pipelineService = new PipelineService();
			var devInstanceUrl = pipelineService.getEnvironmentUrl(PipelineConstants.DEV_ENV_COLUMN);
			appUrl = devInstanceUrl && devInstanceUrl.replace(trailingSlashRegex, '') + path + deploymentRequest.app_sys_id;
		} catch (e) {
			gs.info(e.toString());
		}

        var innerBody = gs.getMessage('{0}Your App Engine Studio administrator did not approve your submitted app and cannot be published, yet. {1}{2}', ['<div>', adminContactMessage, '</div>']);

        innerBody += '<br />';
        innerBody += '<div style="' + style.row + '">';
        innerBody += '<div style="' + style.label + '">' + gs.getMessage('Comment from admin:') + '</div>';
        innerBody += '<div style="' + style.labelValue + '">' + deploymentRequest.rejection_reason + '</div>';
        innerBody += '</div>';
		if (appUrl) {
			innerBody += '<div style="' + style.row + '">';
			innerBody += '<div style="' + style.label + '">' + gs.getMessage('Review your app:') + '</div>';
			innerBody += '<div style="' + style.labelValue + '"><a style="' + style.link + '" href="' + appUrl + '">' + appUrl + '</a></div>';
			innerBody += '</div>';
		}

        return aesEmailScript.getBody(userName, headerMessage, innerBody, footerMessage);
    },
    type: 'AesAppRejectionEmail'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-07-29 20:10:20</sys_created_on>
        <sys_id>da841d75c3121010a9f5e548fa40dd17</sys_id>
        <sys_mod_count>11</sys_mod_count>
        <sys_name>AesAppRejectionEmail</sys_name>
        <sys_package display_value="App Engine Studio" source="sn_app_eng_studio">e046257545b47c84712b8779a9abd0cb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="App Engine Studio">e046257545b47c84712b8779a9abd0cb</sys_scope>
        <sys_update_name>sys_script_include_da841d75c3121010a9f5e548fa40dd17</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-02-09 23:53:35</sys_updated_on>
    </sys_script_include>
</record_update>
