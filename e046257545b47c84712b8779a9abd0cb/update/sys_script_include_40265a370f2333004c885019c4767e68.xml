<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>sn_app_eng_studio.UriUtil</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Collection of utility functions that are used to facilitate the creation of the both the creator and editor URLs for the GetObjects API</description>
        <name>UriUtil</name>
        <script><![CDATA[var UriUtil = (function () {

	CLIENT_SYSPARM_PREFIX = "client:";
	
	return {
	
		/*
		 * return a URI in the format of /<tableName>.do(?queryParameters)
		 */
		createDefaultTableUri : function (tableName, queryParameters, prefixWithSlash) {
		
			if (gs.nil(tableName))
				return null;
			
			if (gs.nil(queryParameters)) {
				queryParameters = {};
			}
			
			if (prefixWithSlash === undefined)
				prefixWithSlash = true;
			
			var baseUri = tableName + ".do";
			
			tableUri = prefixWithSlash ? "/" + baseUri : baseUri;
			
			if (Object.keys(queryParameters).length == 0)
				return tableUri;
			
			return tableUri + "?" + buildQueryParameterString(queryParameters);
			
		},
		
		/*
		 * Takes the specified URI, ensures that it's prefixed with a "/" and handles appending the specified query parameters
		 * to the created URI, i.e. handles cases where the given URI has query parameters and does not have query parameters.
		 */
		createCanonicalizedUri : function (uri, queryParameters) {
			
			if (gs.nil(uri))
				return null;
			
			if (gs.nil(queryParameters)) {
				queryParameters = {};
			}
			
			var canonicalizedUri = uri;
			
			if (!canonicalizedUri.startsWith("/"))
				canonicalizedUri = "/" + canonicalizedUri;
			
			if (Object.keys(queryParameters).length > 0) {
			
				// Check to see if the canonicalized url already has query parameters. If it doesn't then
				// we append a ? because we need to add some query parameters. If it does have query parameters
				// we append a & because we need to add additional query parameters.

				if (!canonicalizedUri.contains("?"))
					canonicalizedUri = canonicalizedUri + "?";
				else
					canonicalizedUri = canonicalizedUri + "&";
			
				canonicalizedUri = canonicalizedUri + buildQueryParameterString(queryParameters);
				
			}			
			
			return canonicalizedUri;
		
		}
			
	};
	
	function buildQueryParameterString(queryParameters) {

		return Object.keys(queryParameters)
			.map(function (queryParamKey){

				var queryParamValue = queryParameters[queryParamKey];

				// Skip encoding any param value that has client: which is short for {client:<paramName>}, i.e. {client:Name}
				// ultimately those values need to be interpolated on the client side.

				var encodedParamValue = encodeQueryParamValue(queryParamValue) ? gs.urlEncode(queryParamValue) : queryParamValue;

				return gs.urlEncode(queryParamKey) + '=' + encodedParamValue;

			})
			.join('&');

	}
	
	/*
	 * There are a couple of query parameter values that should be skipped when URI encoding the query parameters. We
	 * need to skip any value that begins with the CLIENT_SYSPARM_PREFIX because the URI needs to convey that the URI 
	 * requires additional interpolation by the frontend.
	 */
	function encodeQueryParamValue(queryParamValue) {
		return !queryParamValue.contains(CLIENT_SYSPARM_PREFIX);		
	}
	
})();]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-09-04 17:15:57</sys_created_on>
        <sys_id>40265a370f2333004c885019c4767e68</sys_id>
        <sys_mod_count>11</sys_mod_count>
        <sys_name>UriUtil</sys_name>
        <sys_package display_value="App Engine Studio" source="sn_app_eng_studio">e046257545b47c84712b8779a9abd0cb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="App Engine Studio">e046257545b47c84712b8779a9abd0cb</sys_scope>
        <sys_update_name>sys_script_include_40265a370f2333004c885019c4767e68</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-09-05 16:48:47</sys_updated_on>
    </sys_script_include>
</record_update>
