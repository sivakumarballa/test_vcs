<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ws_operation">
    <sys_ws_operation action="INSERT_OR_UPDATE">
        <active>true</active>
        <consumes>application/json,application/xml,text/xml</consumes>
        <consumes_customized>false</consumes_customized>
        <default_operation_uri>/api/sn_app_eng_studio/generic/template-tables</default_operation_uri>
        <enforce_acl/>
        <http_method>GET</http_method>
        <name>GET Template Table Names</name>
        <operation_script><![CDATA[(function process( /*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {
    var tables_output = [];
    var rotatedTables = getRotatedTables();
    var queryParams = request.queryParams;

    if (!queryParams.sysparm_transaction_scope) {
        throw new sn_ws_err.ServiceError()
            .setStatus(500)
            .setMessage('sysparm_transaction_scope query parameter is required.');
    }

    function addAdditionalQueries(gr) {
        if (queryParams.only_extendable && queryParams.only_extendable[0] === 'true')
            gr.addQuery('is_extendable', 'true');
        if (queryParams.only_in_scope && queryParams.only_in_scope[0] === 'true')
            gr.addQuery('sys_scope', queryParams.sysparm_transaction_scope);
        if (queryParams.only_out_of_scope && queryParams.only_out_of_scope[0] === 'true')
            gr.addQuery('sys_scope', '!=', queryParams.sysparm_transaction_scope);
        if (queryParams.order_by && typeof queryParams.order_by[0] === 'string')
            gr.orderBy(queryParams.order_by[0]);
        if (queryParams.limit && typeof queryParams.limit[0] === 'string')
            gr.setLimit(queryParams.limit[0]);
        if (queryParams.search_query && typeof queryParams.search_query[0] === 'string') {
            gr.addEncodedQuery(queryParams.search_query[0]);
        }
    }

    function isExcludedRotation(name) {
        return rotatedTables.indexOf(name) > -1;
    }

    function getRotatedTables() {
        var rotatedList = [];
        var rotations = [];
        var rotatedTable = new GlideRecord("sys_table_rotation");
        rotatedTable.query();

        while (rotatedTable.next())
            rotatedList.push(rotatedTable.getValue("name"));

        var rotatedExtension = new GlideRecord("sys_table_rotation_schedule");
        rotatedExtension.query();

        while (rotatedExtension.next()) {
            if (rotatedList.indexOf(rotatedExtension.getValue("table_name")) === -1)
                rotations.push(rotatedExtension.getValue("table_name"));
        }
        return rotations;
    }

    function startsWith(str, word) {
        return str.lastIndexOf(word, 0) === 0;
    }

    function shouldExcludeTable(tableName) {
        if (isExcludedRotation(tableName))
            return true;

        if (
            startsWith(tableName, 'v_') ||
            startsWith(tableName, 'sysx_') ||
            startsWith(tableName, 'var__') ||
            startsWith(tableName, 'ts_')

        )
            return true;

        return false;
    }

    var tablesGR = new GlideRecord('sys_db_object');
    addAdditionalQueries(tablesGR);
    tablesGR.query();

    while (tablesGR.next()) {
        var tableName = tablesGR.getValue('name');

        if (shouldExcludeTable(tableName))
            continue;

        var table = {
            name: tablesGR.getValue('name'),
            sys_id: tablesGR.getUniqueValue(),
            label: tablesGR.getDisplayValue('label'),
            is_extendable: tablesGR.getValue('is_extendable')
        };
        tables_output.push(table);
    }

    response.setBody(tables_output);
    response.setStatus(200);

})(request, response);]]></operation_script>
        <operation_uri>/api/sn_app_eng_studio/v1/generic/template-tables</operation_uri>
        <produces>application/json,application/xml,text/xml</produces>
        <produces_customized>false</produces_customized>
        <relative_path>/template-tables</relative_path>
        <request_example/>
        <requires_acl_authorization>true</requires_acl_authorization>
        <requires_authentication>true</requires_authentication>
        <requires_snc_internal_role>true</requires_snc_internal_role>
        <short_description/>
        <sys_class_name>sys_ws_operation</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-12-02 21:00:37</sys_created_on>
        <sys_id>1f581696773820106c947206d8106188</sys_id>
        <sys_mod_count>106</sys_mod_count>
        <sys_name>GET Template Table Names</sys_name>
        <sys_package display_value="App Engine Studio" source="sn_app_eng_studio">e046257545b47c84712b8779a9abd0cb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="App Engine Studio">e046257545b47c84712b8779a9abd0cb</sys_scope>
        <sys_update_name>sys_ws_operation_1f581696773820106c947206d8106188</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-02-09 16:45:17</sys_updated_on>
        <web_service_definition display_value="Generic API">37cc9e39c3202010a9f5e548fa40ddef</web_service_definition>
        <web_service_version display_value="v1">f7ec1279c3202010a9f5e548fa40dd4d</web_service_version>
    </sys_ws_operation>
</record_update>
